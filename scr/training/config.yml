# src/training/config.yml
# Configuration for CNN+MLP training and hyperparameter optimisation

project:
  seed: 42
  use_cuda_if_available: true

paths:
  # Feature tables
  features:
    main: "/path/to/Agati_features.xlsx"
    secondary: "/path/to/Agati_features_external.xlsx"

  # Image directory
  difference_images: "/path/to/Difference Images"

  # Output directories
  weights_dir: "/path/to/weights"
  logs_dir: "/path/to/logs"
  figures_dir: "/path/to/figures"

data:
  columns:
    name: "Name"
    class: "Class"
    path: "Path"

  split:
    test_size: 0.2
    val_size: 0.2
    stratify: true
    subject_level: true

  image:
    resize: [250, 250]
    grayscale_channels: 3
    normalize:
      mean: [0.456, 0.456, 0.456]
      std:  [0.225, 0.225, 0.225]

training:
  strategy: "cross_validation"   # options: ["single_split", "cross_validation"]

  base:
    max_epochs: 1000
    early_stopping:
      enabled: true
      patience: 20
      min_epoch: 50

  optimizer:
    type: "adam"
    betas: [0.9, 0.999]
    weight_decay: 0.0

  loss:
    binary:
      type: "BCEWithLogitsLoss"
      class_weighting: "pos_weight"   # computed dynamically
    multiclass:
      type: "CrossEntropyLoss"
      class_weighting: "balanced"

  cross_validation:
    inner_folds: 5
    shuffle: true
    random_state: 42
    max_combinations: 50

hyperparameters:
    batch_size: [4, 8, 16]
    learning_rate: [0.01, 0.001]

    cnn:
      output_dim_binary: [1, "num_additional_features"]
      output_dim_multiclass:  [1, "num_additional_features"]

    mlp:
      binary_layers:
        - [8, 1]
        - [32, 1]
        - [32, 8, 1]
        - [8, 32, 1]
      multiclass_layers:
        - [8, 3]
        - [32, 3]
        - [32, 8, 3]
        - [8, 32, 3]

model:
  architecture: "cnn_mlp"

  cnn:
    backbone: "resnet18"
    pretrained: true
    freeze_backbone: false

  mlp:
    activation: "ReLU"
    dropout: 0.0   # can be extended later

evaluation:
  metrics:
    - "balanced_accuracy"
    - "precision"
    - "recall"
    - "f1"
    - "roc_auc"

  thresholding:
    binary_logit_threshold: 0.0   # logit > 0 => class 1

logging:
  log_level: "INFO"
  save_best_model: true
  verbose_training: true
